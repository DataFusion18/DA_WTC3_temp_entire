annotate("text", x = max(data.set.final.melt.set$Date)-5, y = min(data.set.final.melt.set$value)+5, size = font.size-8, label = paste(as.character(treat.group[v]))) +
# theme(plot.title = element_text(size = 20, face = "bold")) +
theme(legend.title = element_text(colour="black", size=font.size-2)) +
theme(legend.text = element_text(colour="black", size = font.size-3)) +
theme(legend.key.height=unit(0.6,"line")) +
theme(legend.position = c(0.25,0.75),legend.direction = "vertical", legend.text.align = 0) +
theme(legend.key = element_blank()) +
theme(text = element_text(size=font.size)) +
theme(axis.title.x = element_blank()) +
theme(axis.title.y = element_text(size = font.size, vjust=0.3)) +
# theme(plot.title = element_text(hjust = 0)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
}
png("output/Figure_Rabove_balance_v2.png", units="px", width=1600, height=1300, res=220)
print (do.call(grid.arrange,  plot))
dev.off()
treat.group = as.factor(c("ambient","elevated")) # Assign all treatments
data.all = read.csv("processed_data/data_all.csv")
data.all$treatment.no [data.all$Treatment %in% as.factor("ambient") ] = 1
data.all$treatment.no [data.all$Treatment %in% as.factor("elevated") ] = 2
tnc.partitioning = read.csv("processed_data/tnc_partitioning_data.csv")
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
# Model run for WTC3 dataset with clustering
cluster <- makeCluster(detectCores()-1)
# clusterEvalQ(cluster, library(xts))
clusterExport(cl=cluster, list("data.all","tnc.partitioning","treat.group"))
ex <- Filter(function(x) is.function(get(x, .GlobalEnv)), ls(.GlobalEnv))
clusterExport(cluster, ex)
result.cluster = list()
bic.cluster = list()
start <- proc.time() # Start clock
# Test whether parameters need to be seperate for both ambient and warmed treatments
# result <- clusterMap(cluster, CBM.wtc3, treat.group=c(list(list(1,2,c(1,2)))),
#                      MoreArgs=list(chainLength=300, no.param.par.var=2, with.storage=T, model.comparison=F, model.optimization=F))
result <- clusterMap(cluster, CBM.wtc3, treat.group=c(list(list(1,2,c(1,2)))),
MoreArgs=list(chainLength=300, no.param.par.var=2, with.storage=T, model.comparison=F, model.optimization=F))
time_elapsed_series <- proc.time() - start # End clock
stopCluster(cluster)
# listOfDataFrames <- vector(mode = "list", length = length(treat.group[[1]]))
# for (i in 1:length(treat.group[[1]])) {
#   listOfDataFrames[[i]] <- data.frame(result[[i]][[6]])
# }
# bic = do.call("rbind", listOfDataFrames)
# write.csv(bic, "output/bic.csv", row.names=FALSE)
write.csv(result[[1]][[6]], "output/bic.csv", row.names=FALSE)
# Plot parameters and biomass data fit
plot.Modelled.parameters.wtc3(result,with.storage=T)
plot.Modelled.biomass.wtc3(result,with.storage=T)
result[[1]][[6]]
rmd2rscript("report_initial_data_processing_wtc3.Rmd")
source("report_initial_data_processing_wtc3.R")
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
update.packages()
update.packages(ask = FALSE)
version
devtools::install_github("AndreaCirilloAC/updateR")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("AndreaCirilloAC/updateR")
install.packages('devtools') #assuming it is not already installed
library(devtools)
install_github('andreacirilloac/updateR')
library(updateR)
updateR(admin_password = 'c168KMAH')
install.packages("devtools")
version
version
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
warnings()
source('R/q10_calculate.R')
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/q10_calculate.R')
#- process leaf-scale R vs. T data to find q10 value for WTC3
rvt <- read.csv("raw_data/WTC_TEMP_CM_GX-RdarkVsT_20140207-20140423_L1.csv")
rvt$Date <- as.Date(rvt$Date)
rvt.sub <- subset(rvt,Date==as.Date("2014-02-07")) #- just pull out the data measured prior to the drought
rvt.45 <- subset(rvt.sub, Tleaf > 18 & Tleaf<=40)
rvt.45$lnRmass <- log(rvt.45$Rmass)
rvt.45$varT <- (rvt.45$Tleaf-25)/10
rvt.45$Tleaf_bin <- cut(rvt.45$Tleaf,breaks=seq(from=18,to=40,length=25))
rvt.45$Tleaf_bin_mid <- sapply(strsplit(gsub("^\\W|\\W$", "", rvt.45$Tleaf_bin), ","), function(x)sum(as.numeric(x))/2)
rvt.treat.bin <- summaryBy(Rmass+lnRmass+varT~date+T_treatment+Water_treatment+Tleaf_bin_mid,data=rvt.45,keep.names=T,FUN=mean)
#- fit R vs T equation
lmRleaf <- lm(lnRmass~varT+T_treatment+Water_treatment,data=rvt.treat.bin)
summary(lmRleaf)
coef(lmRleaf)
# q10_amb_wet <- unname(exp(coef(lmRleaf)[2]))
# q10_ele_wet <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[3]))
# q10_amb_dry <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[4]))
# q10_ele_dry <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[3]+coef(lmRleaf)[4]))
# No significant difference for drought/control treatments, so only consider temperature treatment effect
lmRleaf_amb <- lm(lnRmass~varT,data=subset(rvt.treat.bin,T_treatment %in% as.factor("ambient")))
q10_amb <- unname(exp(coef(lmRleaf_amb)[2]))
rd25_amb = unname(exp(coef(lmRleaf_amb)[1]))
lmRleaf_ele <- lm(lnRmass~varT,data=subset(rvt.treat.bin,T_treatment %in% as.factor("elevated")))
q10_ele <- unname(exp(coef(lmRleaf_ele)[2]))
rd25_ele = unname(exp(coef(lmRleaf_ele)[1]))
# get model predictions of R across all temperatures
xvals_Rleaf <- seq(18,40, length=101)
# predRleaf_amb <- exp(log(rd25_amb) + (log(q10_amb) * (xvals_Rleaf-25)/10))
# predRleaf_ele <- exp(log(rd25_ele) + (log(q10_ele) * (xvals_Rleaf-25)/10))
# No significant differences between treatments (according to John's paper)
lmRleaf <- lm(lnRmass~varT,data=rvt.treat.bin)
q10 <- unname(exp(coef(lmRleaf)[2])) ########## this is final q10 value for all treatments
predRleaf_amb <- exp(log(rd25_amb) + (log(q10) * (xvals_Rleaf-25)/10))
predRleaf_ele <- exp(log(rd25_ele) + (log(q10) * (xvals_Rleaf-25)/10))
#----------------------------------------------------------------------------------------------------------------
#- plot Rleaf vs. Tair
rvt.treat <- summaryBy(Rmass~Date+T_treatment+Tleaf_bin_mid,data=rvt.treat.bin,keep.names=F,FUN=c(mean,standard.error))
png("output/5.Rdark_vs_T.png", units="px", width=1200, height=1000, res=130)
par(mfrow=c(1,1), mar = c(4,4.5,0.2,0.2))
xlims=c(18,40)
# #- plot MASS BASED leaf R over T for the first date of high resolution T-response curves
plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
# dev.copy2pdf(file="output/5.Rdark_vs_T.pdf")
dev.off()
print ("output/5.Rdark_vs_T.png")
# Chunk 1: load_packages
source('R/load_packages_wtc3.R')
# Chunk 2: load_functions
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
# Chunk 3: plot.model.wtc3
plot.model.wtc3()
# Chunk 4: treatment_selection_strategy
source('R/treatment_selection_strategy.R')
# Chunk 5: inputs
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
# Chunk 6: tnc_partitioning_wtc4
source('R/tnc_partitioning_wtc4.R')
# Chunk 7: tnc_partitioning_data
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
# Chunk 8: GPP_Ra_LA_data
source('R/GPP_Ra_LA_data.R')
# Chunk 9: stem_height_diameter_data
source('R/stem_height_diameter_data.R')
# Chunk 10: rootmass_data
source('R/rootmass_data.R')
# Chunk 11: branch_stem_leafmass_data
source('R/branch_stem_leafmass_data.R')
# Chunk 12: plot_biomass_data
source('R/plot_biomass_data.R')
# Chunk 13: leaf_litter_data
source('R/leaf_litter_data.R')
# Chunk 14: plot_leaf_litter_data
source('R/plot_leaf_litter_data.R')
# Chunk 15: leaf_tnc_data
source('R/leaf_tnc_data.R')
# Chunk 16: plot_leaf_tnc_data
source('R/plot_leaf_tnc_data.R')
# Chunk 17: save_data
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
# Chunk 18: woodmass_rootmass_partitioning
source('R/woodmass_rootmass_partitioning.R')
# Chunk 19: q10_calculate
source('R/q10_calculate.R')
# Chunk 20: leafscaleR_vs_Tair_regression
source('R/leafscaleR_vs_Tair_regression.R')
# Chunk 21: daily_R_rates
source('R/daily_R_rates.R')
# Chunk 22: save_all_data
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
par(mfrow=c(1,1), mar = c(4,4.5,0.2,0.2))
xlims=c(18,40)
# #- plot MASS BASED leaf R over T for the first date of high resolution T-response curves
plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
source('R/q10_calculate.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
source('R/q10_calculate.R')
source('R/q10_calculate.R')
source('R/q10_calculate.R')
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
par(mfrow=c(1,1), mar = c(4,4.5,0.2,0.2))
xlims=c(18,40)
# #- plot MASS BASED leaf R over T for the first date of high resolution T-response curves
p = plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
p
rvt.treat <- summaryBy(Rmass~Date+T_treatment+Tleaf_bin_mid,data=rvt.treat.bin,keep.names=F,FUN=c(mean,standard.error))
# png("output/5.Rdark_vs_T.png", units="px", width=1200, height=1000, res=130)
par(mfrow=c(1,1), mar = c(4,4.5,0.2,0.2))
xlims=c(18,40)
# #- plot MASS BASED leaf R over T for the first date of high resolution T-response curves
plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
dev.copy2pdf(file="output/5.Rdark_vs_T.pdf")
dev.off()
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
usr[1]
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
#- process leaf-scale R vs. T data to find q10 value for WTC3
rvt <- read.csv("raw_data/WTC_TEMP_CM_GX-RdarkVsT_20140207-20140423_L1.csv")
rvt$Date <- as.Date(rvt$Date)
rvt.sub <- subset(rvt,Date==as.Date("2014-02-07")) #- just pull out the data measured prior to the drought
rvt.45 <- subset(rvt.sub, Tleaf > 18 & Tleaf<=40)
rvt.45$lnRmass <- log(rvt.45$Rmass)
rvt.45$varT <- (rvt.45$Tleaf-25)/10
rvt.45$Tleaf_bin <- cut(rvt.45$Tleaf,breaks=seq(from=18,to=40,length=25))
rvt.45$Tleaf_bin_mid <- sapply(strsplit(gsub("^\\W|\\W$", "", rvt.45$Tleaf_bin), ","), function(x)sum(as.numeric(x))/2)
rvt.treat.bin <- summaryBy(Rmass+lnRmass+varT~date+T_treatment+Water_treatment+Tleaf_bin_mid,data=rvt.45,keep.names=T,FUN=mean)
#- fit R vs T equation
lmRleaf <- lm(lnRmass~varT+T_treatment+Water_treatment,data=rvt.treat.bin)
summary(lmRleaf)
coef(lmRleaf)
# q10_amb_wet <- unname(exp(coef(lmRleaf)[2]))
# q10_ele_wet <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[3]))
# q10_amb_dry <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[4]))
# q10_ele_dry <- unname(exp(coef(lmRleaf)[2]+coef(lmRleaf)[3]+coef(lmRleaf)[4]))
# No significant difference for drought/control treatments, so only consider temperature treatment effect
lmRleaf_amb <- lm(lnRmass~varT,data=subset(rvt.treat.bin,T_treatment %in% as.factor("ambient")))
q10_amb <- unname(exp(coef(lmRleaf_amb)[2]))
rd25_amb = unname(exp(coef(lmRleaf_amb)[1]))
lmRleaf_ele <- lm(lnRmass~varT,data=subset(rvt.treat.bin,T_treatment %in% as.factor("elevated")))
q10_ele <- unname(exp(coef(lmRleaf_ele)[2]))
rd25_ele = unname(exp(coef(lmRleaf_ele)[1]))
# get model predictions of R across all temperatures
xvals_Rleaf <- seq(18,40, length=101)
# predRleaf_amb <- exp(log(rd25_amb) + (log(q10_amb) * (xvals_Rleaf-25)/10))
# predRleaf_ele <- exp(log(rd25_ele) + (log(q10_ele) * (xvals_Rleaf-25)/10))
# No significant differences between treatments (according to John's paper)
lmRleaf <- lm(lnRmass~varT,data=rvt.treat.bin)
q10 <- unname(exp(coef(lmRleaf)[2])) ########## this is final q10 value for all treatments
predRleaf_amb <- exp(log(rd25_amb) + (log(q10) * (xvals_Rleaf-25)/10))
predRleaf_ele <- exp(log(rd25_ele) + (log(q10) * (xvals_Rleaf-25)/10))
#----------------------------------------------------------------------------------------------------------------
#- plot Rleaf vs. Tair
rvt.treat <- summaryBy(Rmass~Date+T_treatment+Tleaf_bin_mid,data=rvt.treat.bin,keep.names=F,FUN=c(mean,standard.error))
png("output/5.Rdark_vs_T.png", units="px", width=1200, height=1000, res=130)
par(mfrow=c(1,1), mar = c(4,4.5,0.2,0.2))
xlims=c(18,40)
# #- plot MASS BASED leaf R over T for the first date of high resolution T-response curves
plotBy(Rmass.mean~Tleaf_bin_mid|T_treatment,data=rvt.treat,
xlab=expression(Temperature~(degree*C)),ylab=expression(R[leaf]~(mu*mol~CO[2]~m^-2~s^-1)),col=c("black","red"),pch=1,
xlim=xlims,type="p",lwd=3,cex=0.3,cex.lab=1,legend=F,
panel.first=adderrorbars(x=rvt.treat$Tleaf_bin_mid,y=rvt.treat$Rmass.mean,SE=rvt.treat$Rmass.standard.error,direction="updown"))
# magaxis(side=c(1,2,3,4),labels=c(1,1,0,1))
# title(xlab=expression(Temperature~(degree*C)),xpd=NA)
lines(x=xvals_Rleaf,y=predRleaf_amb,col="black",lwd=2)
lines(x=xvals_Rleaf,y=predRleaf_ele,col="red",lwd=2)
legend("topleft",legend=unique(rvt.treat$T_treatment),col=c('black','red'),lty=1,bty="n",cex=0.8,pt.cex=1.2)
# dev.copy2pdf(file="output/5.Rdark_vs_T.pdf")
dev.off()
img <- readPNG("output/5.Rdark_vs_T.png")
# h<-dim(img)[1]
# w<-dim(img)[2]
#
# # #open new file for saving the image in "output" folder
# # png("output/Figure_1_CBM_wtc3.png", width=w, height=h)
# par(mar=c(0,0,0,0), xpd=NA, mgp=c(0,0,0), oma=c(0,0,0,0), ann=F)
# plot.new()
# plot.window(0:1, 0:1)
#
# #fill plot with image
# usr<-par("usr")
# rasterImage(img, usr[1], usr[3], usr[2], usr[4])
grid.raster(img, width = 5)
# plot.q10()
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
source('R/q10_calculate.R')
source('R/load_packages_wtc3.R')
source("R/functions_wtc3.R")
source("R/functions_wtc3_CBM.R")
plot.model.wtc3()
source('R/treatment_selection_strategy.R')
c1 = 0.48 # (unit conversion from gDM to gC: 1 gDM = 0.48 gC)
source('R/tnc_partitioning_wtc4.R')
write.csv(tnc.partitioning, file = "processed_data/tnc_partitioning_data.csv", row.names = FALSE)
source('R/GPP_Ra_LA_data.R')
source('R/stem_height_diameter_data.R')
source('R/rootmass_data.R')
source('R/branch_stem_leafmass_data.R')
source('R/plot_biomass_data.R')
source('R/leaf_litter_data.R')
source('R/plot_leaf_litter_data.R')
source('R/leaf_tnc_data.R')
source('R/plot_leaf_tnc_data.R')
write.csv(data.GPP.Ra.LA.mass, file = "processed_data/GPP_Ra_LA_mass.csv", row.names = FALSE)
source('R/woodmass_rootmass_partitioning.R')
source('R/q10_calculate.R')
source('R/leafscaleR_vs_Tair_regression.R')
source('R/daily_R_rates.R')
write.csv(data.all, "processed_data/data_all.csv", row.names=FALSE) # unit of respiration rates: gC per gC plant per day
